Bootstrap: docker
From: awesomebytes/gentoo_prefix_ci_prepare
Stage: spython-base

# This container installs Gentoo Prefix non-interactively in ${EPREFIX}.

%post

# Let's get some specs of the machine that is running this job
cat /proc/cpuinfo && cat /proc/meminfo && df -h

mkdir /scratch

cd /usr/local/bin
# Get EESSI or Official bootstrap script
# wget https://gitweb.gentoo.org/repo/proj/prefix.git/plain/scripts/bootstrap-prefix.sh
wget https://raw.githubusercontent.com/EESSI/compatibility-layer/master/bootstrap-prefix.sh
chmod +x bootstrap-prefix.sh

%environment
#   export EPREFIX=/scratch/gentoo
   export LC_ALL=C
   export PATH=/usr/local/bin:$PATH

%runscript
   exec /usr/local/bin/bootstrap-prefix.sh "$@" 

%test
    grep -q NAME=\"Ubuntu\" /etc/os-release
    if [ $? -eq 0 ]; then
        echo "Container base is Ubuntu as expected."
    else
        echo "Container base is not Ubuntu."
    fi
